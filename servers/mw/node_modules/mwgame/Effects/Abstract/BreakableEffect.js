/**
 * Effet brisable par les projectile qui percutent la cible 
 */

var O2 = require('o2');
var Effect = require('./Effect.js');

var ADV_BreakableEffect = O2.extendClass(Effect, {
	_nDamageTaken: 0, // dégâts encaissé par l'effet
	_nSourceStrength: 0,
	_nTargetStrength: 0,
	
	__construct: function() {
		var aArgs = Array.prototype.slice.call(arguments, 0);
		aArgs.push('breakable');
		aArgs.unshift(this);
		O2.parent.apply(O2, aArgs);
	},
	
	setSource: function(oSource) {
		O2.parent(this, oSource);
		if (oSource && oSource.getSoul()) {
			this._nSourceStrength = oSource.getSoul().getAttribute('prof_holdroot');
		} else {
			this._nSourceStrength = 0;
		}
	},

	setTarget: function(oTarget) {
		O2.parent(this, oTarget);
		if (oTarget && oTarget.getSoul()) {
			this._nTargetStrength = oTarget.getSoul().getAttribute('prof_holdroot');
		} else {
			this._nTargetStrength = 0;
		}
	},
	
	/**
	 * Fonction spéciale d'endommagement de l'effet quand on tire dessus
	 */
	damage: function(n) {
		this._nDamageTaken += n;
		if (this._nDamageTaken >= (this._nSourceStrength + this.getLevel() - this._nTargetStrength) ) {
			this.dispel();
		}
	}
});

module.exports = ADV_BreakableEffect;
