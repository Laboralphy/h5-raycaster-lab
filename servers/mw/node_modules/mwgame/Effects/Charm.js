var O2 = require('o2');
var Effect = require('./Abstract/Effect.js');

// Effet de confusion
O2.extendClass('ADV.Effect.Charm', Effect, {
	
	__construct: function() {
		O2.parent(this, 'Charm', 'curse');
	},
	
	cast: function(ep) {
		var oMonster = this.getTarget();
		var oSoul = oMonster.getSoul();
		oSoul.setBonus('charmed', 1);
		if (oMonster.getData('summoner')) {
			oMonster.getThinker().setMode('patrol');
			oMonster.setData('charmer', this.getSource());
		}	
	},
	
	accept: function(ep) {
		var oMonster = this.getTarget();
		return !!oMonster.getData('summoner');
	},

	
	expire: function(ep) {
		var oMonster = this.getTarget();
		var oSoul = oMonster.getSoul();
		oSoul.setBonus('charmed', -1);
		if (oSoul.getAttribute('charmed') == 0 && oMonster.getData('summoner')) {
			oMonster.setData('charmer', null);
		}	
	}
});

module.exports = ADV.Effect.Charm;
